/*
Places (Find my nearest)
*/
var setup_places=function(){var e=new AlphaGeoForm("#local-locator-form"),t=function(){$(".further_information").hide(),$("#options-loading").removeClass("hidden"),$.ajax({url:(document.location+".json").replace(/\/\.json$/,".json"),dataType:"json",data:{lat:AlphaGeo.full_location.current_location.lat,lon:AlphaGeo.full_location.current_location.lon},type:"POST",success:function(e){$("#options-loading").addClass("hidden"),e.places.length>0?($("h3#options-header").show().removeClass("hidden"),$("#options").html($.mustache($("#option-template").html(),{options:e.places}))):$("#results-error").removeClass("hidden").find("p").text("Sorry, no results were found near you."),_gaq.push(["_trackEvent","Citizen-Format-Findmynearest","Success-results"]),$("#options-header").show()}})},n=function(){$("#options").html(""),$("#options-header").hide(),$("#results-error").addClass("hidden")};$(AlphaGeo).bind("location-removed",function(e,t){n(),$(".further_information").show()}),$(AlphaGeo).bind("location-completed",function(e,r){n(),$("strong.locality_placeholder").text(AlphaGeo.full_location.current_location.locality),t()})};$(function(){$("#wrapper").attr("class").match(/place/)&&setup_places()}),$(function(){function n(){var e=$(".nav-tabs a").map(function(e,t){return $(t).attr("href").split("#").pop()}),t=$("input[name=tab]"),n=$.inArray(t.val(),e);return n>-1?n:0}function r(e,n){if(typeof n!="undefined"){var r=$("input[name=tab]");r.length===0&&(r=$('<input type="hidden" name="tab">'),t.prepend(r)),r.val(n)}}var e=$("#search-results-tabs"),t=$(".js-search-hash");e.length>0&&e.tabs({defaultTab:n()}),t.length&&e.on("tabChanged",r)}),$(document).ready(function(){var e=$("section.more");e.find(".js-tabs").length&&e.tabs(),$("#get-started a.toolbar-disabled").click(function(e){window.open($(this).attr("href"),"govuk_transaction_window","toolbar=no,resizable=yes,scrollbars=yes"),e.preventDefault()})});